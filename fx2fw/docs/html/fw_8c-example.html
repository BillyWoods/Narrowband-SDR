<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fx2lib: fw.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Fx2lib
   &#160;<span id="projectnumber">0.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">fw.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>The firmware framework allows for easily beginning a new firware project.</p>
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fx2macros_8h.html">fx2macros.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fx2ints_8h.html">fx2ints.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="autovector_8h.html">autovector.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="delay_8h.html">delay.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="setupdat_8h.html">setupdat.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef DEBUG_FIRMWARE </span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="serial_8h.html">serial.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor">#define printf(...)</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">volatile</span> __bit dosud=<a name="a0"></a><a class="code" href="fx2types_8h.html#acfa04764efb00fc412359554dd70fff2aa1e095cc966dbecf6a0d8aad75348d1a">FALSE</a>;</div><div class="line"><span class="keyword">volatile</span> __bit dosuspend=<a class="code" href="fx2types_8h.html#acfa04764efb00fc412359554dd70fff2aa1e095cc966dbecf6a0d8aad75348d1a">FALSE</a>;</div><div class="line"></div><div class="line"><span class="comment">// custom functions</span></div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> main_loop();</div><div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> main_init();</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> main() {</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef DEBUG_FIRMWARE</span></div><div class="line"> <a name="a1"></a><a class="code" href="fx2macros_8h.html#a85439206834e5f5b2b948c6084e18232">SETCPUFREQ</a>(<a name="a2"></a><a class="code" href="fx2macros_8h.html#a67f3f766a011dd62ac7cae6dfb8b32feaad55ec0a3c2b236a8ef306e941f1f845">CLK_48M</a>); <span class="comment">// required for sio0_init </span></div><div class="line"> <span class="comment">// main_init can still set this to whatever you want.</span></div><div class="line"> <a name="a3"></a><a class="code" href="serial_8h.html#a8b3b41fc935faae2abe4b4e80d0d1d12">sio0_init</a>(57600); <span class="comment">// needed for printf if debug defined </span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"> main_init();</div><div class="line"></div><div class="line"> <span class="comment">// set up interrupts.</span></div><div class="line"> <a name="a4"></a><a class="code" href="autovector_8h.html#a1075368b1aef9ee174d20e697c20f853">USE_USB_INTS</a>();</div><div class="line"> </div><div class="line"> <a name="a5"></a><a class="code" href="autovector_8h.html#a875914c354c8bb520abd2e3bb7e3a86e">ENABLE_SUDAV</a>();</div><div class="line"> <a name="a6"></a><a class="code" href="autovector_8h.html#ad0961fc983212f47b9303b01ae07abdf">ENABLE_USBRESET</a>();</div><div class="line"> <a name="a7"></a><a class="code" href="autovector_8h.html#a9da28432c254ba886f731fb95d7ffeda">ENABLE_HISPEED</a>(); </div><div class="line"> <a name="a8"></a><a class="code" href="autovector_8h.html#a23d6df992251bc62695356c41db3d943">ENABLE_SUSPEND</a>();</div><div class="line"> <a name="a9"></a><a class="code" href="fx2ints_8h.html#a95df470686ff623c08b75542247f52b1">ENABLE_RESUME</a>();</div><div class="line"></div><div class="line"> <a name="a10"></a><a class="code" href="fx2regs_8h.html#a6f266163c3c2a39e8dbafb495fb62a8b">EA</a>=1;</div><div class="line"></div><div class="line"><span class="comment">// iic files (c2 load) don&#39;t need to renumerate/delay</span></div><div class="line"><span class="comment">// trm 3.6</span></div><div class="line"><span class="preprocessor">#ifndef NORENUM</span></div><div class="line"> <a name="a11"></a><a class="code" href="fx2macros_8h.html#a90cc977065675579e3898ff2bbd9093a">RENUMERATE</a>();</div><div class="line"><span class="preprocessor">#else</span></div><div class="line"> <a name="a12"></a><a class="code" href="fx2regs_8h.html#a845289414ba06ac5056c9da9774e52bf">USBCS</a> &amp;= ~<a name="a13"></a><a class="code" href="fx2regs_8h.html#a36e8ad3a10c137c3c6778aae82041a62">bmDISCON</a>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"> </div><div class="line"> <span class="keywordflow">while</span>(<a name="a14"></a><a class="code" href="fx2types_8h.html#acfa04764efb00fc412359554dd70fff2aa82764c3079aea4e60c80e45befbb839">TRUE</a>) {</div><div class="line"></div><div class="line">     main_loop();</div><div class="line"></div><div class="line">     <span class="keywordflow">if</span> (dosud) {</div><div class="line">       dosud=<a class="code" href="fx2types_8h.html#acfa04764efb00fc412359554dd70fff2aa1e095cc966dbecf6a0d8aad75348d1a">FALSE</a>;</div><div class="line">       <a name="a15"></a><a class="code" href="setupdat_8h.html#ad6bf0b58c902d6fc13d9a0630d95c8a0">handle_setupdata</a>();</div><div class="line">     }</div><div class="line"></div><div class="line">     <span class="keywordflow">if</span> (dosuspend) {</div><div class="line">        dosuspend=<a class="code" href="fx2types_8h.html#acfa04764efb00fc412359554dd70fff2aa1e095cc966dbecf6a0d8aad75348d1a">FALSE</a>;</div><div class="line">        <span class="keywordflow">do</span> {</div><div class="line">           printf ( <span class="stringliteral">&quot;I&#39;m going to Suspend.\n&quot;</span> );</div><div class="line">           <a name="a16"></a><a class="code" href="fx2regs_8h.html#ab8ae90e81fc4fab1513fee4a70ebfb22">WAKEUPCS</a> |= <a name="a17"></a><a class="code" href="fx2regs_8h.html#ace69e6a6ab10c5723b74ba4eb93ccf2f">bmWU</a>|<a name="a18"></a><a class="code" href="fx2regs_8h.html#aab0b110a0756155959fee58a7faddca1">bmWU2</a>; <span class="comment">// make sure ext wakeups are cleared</span></div><div class="line">           <a name="a19"></a><a class="code" href="fx2regs_8h.html#a1f5276b725b267eb1cc2591c8423554a">SUSPEND</a>=1;</div><div class="line">           <a name="a20"></a><a class="code" href="fx2regs_8h.html#a33f04ca1a406af08575385d15c3be951">PCON</a> |= 1;</div><div class="line">           __asm</div><div class="line">           nop</div><div class="line">           nop</div><div class="line">           nop</div><div class="line">           nop</div><div class="line">           nop</div><div class="line">           nop</div><div class="line">           nop</div><div class="line">           __endasm;</div><div class="line">        } <span class="keywordflow">while</span> ( !<a name="a21"></a><a class="code" href="setupdat_8h.html#a0ed0635245ebea7919f2b0600d701b2d">remote_wakeup_allowed</a> &amp;&amp; <a name="a22"></a><a class="code" href="fx2macros_8h.html#a8228b1a75679036ba2b6e59538fbd227">REMOTE_WAKEUP</a>()); </div><div class="line">        printf ( <span class="stringliteral">&quot;I&#39;m going to wake up.\n&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">// resume</span></div><div class="line">        <span class="comment">// trm 6.4</span></div><div class="line">        <span class="keywordflow">if</span> ( <a class="code" href="fx2macros_8h.html#a8228b1a75679036ba2b6e59538fbd227">REMOTE_WAKEUP</a>() ) {</div><div class="line">            <a name="a23"></a><a class="code" href="delay_8h.html#a483e8dfb2de1a2b29a6c2f806fefe404">delay</a>(5);</div><div class="line">            <a class="code" href="fx2regs_8h.html#a845289414ba06ac5056c9da9774e52bf">USBCS</a> |= <a name="a24"></a><a class="code" href="fx2regs_8h.html#a54116c48efff8d4df095a3071593b13d">bmSIGRESUME</a>;</div><div class="line">            <a class="code" href="delay_8h.html#a483e8dfb2de1a2b29a6c2f806fefe404">delay</a>(15);</div><div class="line">            <a class="code" href="fx2regs_8h.html#a845289414ba06ac5056c9da9774e52bf">USBCS</a> &amp;= ~<a class="code" href="fx2regs_8h.html#a54116c48efff8d4df095a3071593b13d">bmSIGRESUME</a>;</div><div class="line">        }</div><div class="line"></div><div class="line">     }</div><div class="line"></div><div class="line"> } <span class="comment">// end while</span></div><div class="line"></div><div class="line">} <span class="comment">// end main</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> resume_isr() __interrupt <a name="a25"></a><a class="code" href="fx2ints_8h.html#a48b90e65d400542fd0fecf54ab31da1ea72aa08501004f9ba4cc88a3d35835130">RESUME_ISR</a> {</div><div class="line"> <a name="a26"></a><a class="code" href="fx2ints_8h.html#ac2086c0e85e889d34e6892d2c484a3fd">CLEAR_RESUME</a>();</div><div class="line">}</div><div class="line">  </div><div class="line"><span class="keywordtype">void</span> <a name="a27"></a><a class="code" href="autovector_8h.html#aff7556bfde04a0c2da9b84e4ab6ec827">sudav_isr</a>() __interrupt <a name="a28"></a><a class="code" href="autovector_8h.html#abc626159c878a9a277f47d71a79e7c34a1b501c443ad73d66726f98181f729620">SUDAV_ISR</a> {</div><div class="line"> dosud=<a class="code" href="fx2types_8h.html#acfa04764efb00fc412359554dd70fff2aa82764c3079aea4e60c80e45befbb839">TRUE</a>;</div><div class="line"> <a name="a29"></a><a class="code" href="autovector_8h.html#a40de022c347065936f788fc320056003">CLEAR_SUDAV</a>();</div><div class="line">}</div><div class="line"><span class="keywordtype">void</span> <a name="a30"></a><a class="code" href="autovector_8h.html#afca3446b82251f73daea6cec673f3bff">usbreset_isr</a>() __interrupt <a name="a31"></a><a class="code" href="autovector_8h.html#abc626159c878a9a277f47d71a79e7c34a9bd47dd8ceb10c7f768c7362a5334e07">USBRESET_ISR</a> {</div><div class="line"> <a name="a32"></a><a class="code" href="setupdat_8h.html#a873d26420c81b22db52bfc53b214e91a">handle_hispeed</a>(<a class="code" href="fx2types_8h.html#acfa04764efb00fc412359554dd70fff2aa1e095cc966dbecf6a0d8aad75348d1a">FALSE</a>);</div><div class="line"> <a name="a33"></a><a class="code" href="autovector_8h.html#a955ce72b3d57ceb582d1755e4e221401">CLEAR_USBRESET</a>();</div><div class="line">}</div><div class="line"><span class="keywordtype">void</span> <a name="a34"></a><a class="code" href="autovector_8h.html#a63249880100d58019a835a9ae8a4fe14">hispeed_isr</a>() __interrupt <a name="a35"></a><a class="code" href="autovector_8h.html#abc626159c878a9a277f47d71a79e7c34a3674d45bfc937779b77f6494ec203c32">HISPEED_ISR</a> {</div><div class="line"> <a class="code" href="setupdat_8h.html#a873d26420c81b22db52bfc53b214e91a">handle_hispeed</a>(<a class="code" href="fx2types_8h.html#acfa04764efb00fc412359554dd70fff2aa82764c3079aea4e60c80e45befbb839">TRUE</a>);</div><div class="line"> <a name="a36"></a><a class="code" href="autovector_8h.html#ad0056e85bd6c6a0fdfe2729fe3fc9586">CLEAR_HISPEED</a>();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a name="a37"></a><a class="code" href="autovector_8h.html#a7cce83f6e1f7ffed2de9ed75e0ba6b90">suspend_isr</a>() __interrupt <a name="a38"></a><a class="code" href="autovector_8h.html#abc626159c878a9a277f47d71a79e7c34a7ccd5a6d6c876c4735ac160b2888fe37">SUSPEND_ISR</a> {</div><div class="line"> dosuspend=<a class="code" href="fx2types_8h.html#acfa04764efb00fc412359554dd70fff2aa82764c3079aea4e60c80e45befbb839">TRUE</a>;</div><div class="line"> <a name="a39"></a><a class="code" href="autovector_8h.html#a4f8b89940af82278db41486b83c55ba3">CLEAR_SUSPEND</a>();</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
